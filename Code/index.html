<script>
  // 转换前：
  const data = [
    {
      id: 1,
      pid: 0,
      name: 'body',
    },
    {
      id: 2,
      pid: 1,
      name: 'title',
    },
    {
      id: 3,
      pid: 2,
      name: 'div',
    },
    {
      id: 4,
      name: '444',
    },
  ]
  // 转换为:
  const tree = [
    {
      id: 1,
      pid: 0,
      name: 'body',
      children: [
        {
          id: 2,
          pid: 1,
          name: 'title',
          children: [
            {
              id: 3,
              pid: 1,
              name: 'div',
            },
          ],
        },
      ],
    },
    {
      id: 4,
      name: '444',
    },
  ]

  function jsonToTree(data) {
    const result = []
    const map = {}
    data.forEach((item) => (map[item.id] = item))
    data.forEach((item) => {
      const parent = map[item.pid]
      if (parent) (parent.children || (parent.children = [])).push(item)
      else result.push(item)
    })
    return result
  }

  const json2tree = (arr) => {
    const map = new Map()
    const result = []
    arr.forEach((item) => map.set(item.id, item))

    arr.forEach((item) => {
      const parent = map.get(item.pid)
      if (parent) (parent.children || (parent.children = [])).push(item)
      else result.push(item)
    })
    return result
  }

  console.log(json2tree(data))
  console.log(json2tree(data))
  console.log(json2tree(data))
  console.log(json2tree(data))
</script>
