<script>
  Array.prototype._reduce = function (fn, init) {
    let res = init || this[0]
    for (let i = init ? 0 : 1; i < this.length; i++) {
      res = fn(res, this[i], i, this)
    }
    return res
  }

  Array.prototype._flat = function (depth = 1) {
    return depth > 0
      ? this._reduce(
          (pre, cur) =>
            pre.concat(Array.isArray(cur) ? cur._flat(depth - 1) : cur),
          []
        )
      : this.slice()
  }

  const test = [
    [1, [2], [[3]], [[[4]]]],
    [[2], [2], [[[[[[4]]]]]]],
    [1, [1, [1]]],
  ]

  test.forEach((arr) => console.log(arr._flat(Infinity)))
</script>

<script>
  Array.prototype._reduce = function (fn, init) {
    let res = init || this[0]
    for (let i = init ? 0 : 1; i < this.length; i++) {
      res = fn(res, this[i], i, this)
    }
    return res
  }
</script>

<script>
  Array.prototype._flat = function (depth = 1) {
    return depth > 0
      ? this.reduce(
          (pre, cur) =>
            pre.concat(Array.isArray(cur) ? cur._flat(depth - 1) : cur),
          []
        )
      : this.slice()
  }
</script>
